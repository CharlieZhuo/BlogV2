# Theming MUI components

## Overview

主题 Theme 能让你在一个地点定义应用的所有 MUI 组件的样式（颜色，阴影，间距等）。应用样式有助于在应用中实现统一样式的组件，这在应用有多个开发者时更为重要。
主题还是实现夜间模式（dark mode）及用户定制主题的方便方法。

MUI 组件默认就附带了一个主题。

## 创建自定义主题

最简单方式是改变主题对象的下列属性并传给 createTheme 函数
.palette
.typography
.spacing
.breakpoints
.zIndex
.transitions
.components

例如
const theme = createTheme({
palette: {
primary: {
main: purple[500],
},
secondary: {
main: green[500],
},
},
});

返回的主题即在默认主题的基础上应用了参数中的自定义。

createTheme 提供的第一个以外的参数会与返回值深层合并（deep merged,即子属性树也合并），但不会在函数体中被处理。

若要合并多个定制主题对象，并创建一个自己的定制对象，可以先合并它们在当作第一个参数传给 createTheme
例如

const theme = createTheme(deepmerge(options1, options2));

若一些定制选项依赖于其他定制选项，可分步组合它们
let theme = createTheme({
palette: {
primary: {
main: '#0052cc',
},
secondary: {
main: '#edf2ff',
},
},
});

theme = createTheme(theme, {
palette: {
info: {
main: theme.palette.secondary.main,
},
},
});
上面 palette.info.main 依赖于之前定制的 palette.secondary.main

## 应用自定义的 Mui 主题

使用**ThemeProvider**将订制主题注入到你的应用。ThemeProvider 使用 react 的 context api 将主题传入组件树中的 MUI 组件。

例如,向一个组件注入自定义主题：

```<ThemeProvider theme={theme}>
  <CustomCheckbox defaultChecked />
</ThemeProvider>
```

若要应用全局主题，可用 ThemeProvider 包裹整个应用组件树

ThemeProvider 还可以嵌套 例如

```<ThemeProvider theme={outerTheme}>
  <Checkbox defaultChecked />
  <ThemeProvider theme={innerTheme}>
    <Checkbox defaultChecked />
  </ThemeProvider>
</ThemeProvider>
```

里面的 ThemeProvider 会覆盖外面的 ThemeProvider 提供的主题

## 用 palette 属性定制颜色

主题中有下列颜色子属性

- primary 主颜色 最常见颜色
- secondary（可选） 次颜色
- error 错误颜色
- warning 警告颜色
- info 中立及不重要信息颜色
- success 成功颜色

子属性应为符合下列 ts 接口对象
interface PaletteColor {
light?: string;
main: string;
dark?: string;
contrastText?: string;
}
如
secondary: {
main: '#f44336',
},

或者从@mui/material/colors 导入的颜色之一，如
//import { purple } from '@mui/material/colors';
primary: {
main: purple[500],
},

light,dark 及 contrastText 当未提供时将从 main 计算出来。

    // Used by `getContrastText()` to maximize the contrast between
    // the background and the text.
    contrastThreshold: 3,
    // Used by the functions below to shift a color's luminance by approximately
    // two indexes within its tonal palette.
    // E.g., shift from Red 500 to Red 300 or Red 700.
    tonalOffset: 0.2,

使用 TS 时 应声明模组，如
declare module '@mui/material/styles' {
interface Theme {
status: {
danger: React.CSSProperties['color'];
};
}

interface Palette {
neutral: Palette['primary'];
}
interface PaletteOptions {
neutral: PaletteOptions['primary'];
}

interface PaletteColor {
darker?: string;
}
interface SimplePaletteColorOptions {
darker?: string;
}
interface ThemeOptions {
status: {
danger: React.CSSProperties['color'];
};
}
}

### 夜间模式

palette 中添加属性

```
palette: {
    mode: 'dark',
  },
```

#### 切换夜间模式

完全手动的方式，一个切换夜间模式的开关通过 react 的 context api 在开关变化时修改 context。ThemeProvider 通过 context 获取的信息决定传给组件树的 theme 中的 mode。

用户还可能以其他方式表示了他们想要的色彩主题，比如操作系统的颜色主题或浏览器的设置。
可以通过 useMediaQuery hook 检测这些设置：

```
import * as React from 'react';
import useMediaQuery from '@mui/material/useMediaQuery';
import { createTheme, ThemeProvider } from '@mui/material/styles';
import CssBaseline from '@mui/material/CssBaseline';

function App() {
  const prefersDarkMode = useMediaQuery('(prefers-color-scheme: dark)');

  const theme = React.useMemo(
    () =>
      createTheme({
        palette: {
          mode: prefersDarkMode ? 'dark' : 'light',
        },
      }),
    [prefersDarkMode],
  );

  return (
    <ThemeProvider theme={theme}>
      <CssBaseline />
      <Routes />
    </ThemeProvider>
  );
}
```

## 文字

使用 theme 中的 typography 属性设置有关文字的样式

### 字体

例如
typography: {
fontFamily: [
'-apple-system',
'BlinkMacSystemFont',
'"Segoe UI"',
'Roboto',
'"Helvetica Neue"',
'Arial',
'sans-serif',
'"Apple Color Emoji"',
'"Segoe UI Emoji"',
'"Segoe UI Symbol"',
].join(','),
},

### 字体大小

MUI 使用 rem 作为字体大小单位
例如
typography: {
// In Chinese and Japanese the characters are usually larger,
// so a smaller fontsize may be appropriate.
fontSize: 12,
},

浏览器计算的字体大小公式

使用 responsiveFontSizes()自动创建响应式字体大小，随屏幕宽度改变 例如
theme = responsiveFontSizes(theme);

改变 html 字体大小
typography: {
// Tell MUI what's the font-size on the html element is.
htmlFontSize: 10,
},

### 变体

还可以改变变体的字体风格 有下列默认变体

- h1
- h2
- h3
- h4
- h5
- h6
- subtitle1
- subtitle2
- body1
- body2
- button
- caption
- overline
  每种都可单独设置 例如

```typography: {
    subtitle1: {
      fontSize: 12,
    },
    body1: {
      fontWeight: 500,
    },
    button: {
      fontStyle: 'italic',
    },
  },
```

还可添加自定义变体以及禁用已有变体 例如

```typography: {
    poster: {
      color: 'red',
    },
    // Disable h3 variant
    h3: undefined,
  },
```

ts 用户需更新类型定义 例如

```declare module '@mui/material/styles' {
  interface TypographyVariants {
    poster: React.CSSProperties;
  }

  // allow configuration using `createTheme`
  interface TypographyVariantsOptions {
    poster?: React.CSSProperties;
  }
}

// Update the Typography's variant prop options
declare module '@mui/material/Typography' {
  interface TypographyPropsVariantOverrides {
    poster: true;
    h3: false;
  }
}
```

## 间距

MUI 默认将 8px 作为间距的缩放单位
例如

```const theme = createTheme();

theme.spacing(2); // `${8 * 2}px` = '16px'
```

可用 theme 对象的 spacing 属性改变

```a number
const theme = createTheme({
  spacing: 4,
});

theme.spacing(2); // `${4 * 2}px` = '8px'
a function
const theme = createTheme({
  spacing: (factor) => `${0.25 * factor}rem`, // (Bootstrap strategy)
});

theme.spacing(2); // = 0.25 * 2rem = 0.5rem = 8px
an array
const theme = createTheme({
  spacing: [0, 4, 8, 16, 32, 64],
});

theme.spacing(2); // = '8px'
```

## 断点

MUI 使用简化版本的原 material design 的断点

### 默认断点

1. xs, extra-small: 0px
2. sm, small: 600px
3. md, medium: 900px
4. lg, large: 1200px
5. xl, extra-large: 1536px

### 主题定义中的断点使用

- theme.breakpoints.up(key)
- theme.breakpoints.down(key)
- theme.breakpoints.only(key)
- theme.breakpoints.not(key)
- theme.breakpoints.between(start, end)
  例如根据屏宽改变主题中的背景颜色

```
const styles = (theme) => ({
  root: {
    padding: theme.spacing(1),
    [theme.breakpoints.down('md')]: {
      backgroundColor: theme.palette.secondary.main,
    },
    [theme.breakpoints.up('md')]: {
      backgroundColor: theme.palette.primary.main,
    },
    [theme.breakpoints.up('lg')]: {
      backgroundColor: green[500],
    },
  },
});
```

在组件中 可用 useMediaQuery hook,查询当前媒体是否符合参数中给定的 css 媒体查询
例如 宽度 600px 以上
` const matches = useMediaQuery('(min-width:600px)');`
例如 夜间模式
` const matches = useMediaQuery('(prefers-color-scheme: dark)');`
例如 符合断点

```const theme = useTheme();
  const matches = useMediaQuery(theme.breakpoints.up('sm'));
```

### 自定义断点

例如 改变默认断点的宽度

```const theme = createTheme({
  breakpoints: {
    values: {
      xs: 0,
      sm: 600,
      md: 900,
      lg: 1200,
      xl: 1536,
    },
  },
});
```

例如添加新断点

```const theme = createTheme({
  breakpoints: {
    values: {
      mobile: 0,
      tablet: 640,
      laptop: 1024,
      desktop: 1200,
    },
  },
});
```

ts 用户需更新类型定义

```declare module '@mui/material/styles' {
  interface BreakpointOverrides {
    xs: false; // removes the `xs` breakpoint
    sm: false;
    md: false;
    lg: false;
    xl: false;
    mobile: true; // adds the `mobile` breakpoint
    tablet: true;
    laptop: true;
    desktop: true;
  }
}
```
